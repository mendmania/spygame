{
  "rules": {
    "adminIndex": {
      ".read": false,
      ".write": false,
      "rooms": {
        "$game": {
          "$roomId": {
            ".read": false,
            ".write": false
          }
        }
      },
      "analytics": {
        ".read": false,
        ".write": false
      }
    },

    "adminUsers": {
      ".read": false,
      ".write": false
    },

    "games": {
      "spyfall": {
        "rooms": {
          "$roomId": {
            "meta": {
              ".read": true,
              ".write": "!data.exists() || auth != null",
              "status": {
                ".write": false
              }
            },

            "players": {
              ".read": true,
              "$playerId": {
                ".write": "auth != null && auth.uid == $playerId",
                "isHost": {
                  ".write": false
                }
              }
            },

            "state": {
              ".read": true,
              ".write": false
            },

            "privatePlayerData": {
              ".read": false,
              "$playerId": {
                ".read": "auth != null && auth.uid == $playerId",
                ".write": false
              }
            }
          }
        }
      },

      "codenames": {
        ".read": false,
        ".write": false
      },
      
      "werewolf": {
        "rooms": {
          "$roomId": {
            // Room meta: readable by all, only server can change status
            "meta": {
              ".read": true,
              ".write": "!data.exists() || auth != null",
              "status": {
                // CRITICAL: status can ONLY be changed by server (admin SDK)
                // This prevents client-side phase manipulation
                ".write": false
              },
              "settings": {
                ".write": "auth != null"
              }
            },

            // Players: readable by all, individual player can update their own non-sensitive fields
            "players": {
              ".read": true,
              "$playerId": {
                // Players can only write their own data
                ".write": "auth != null && auth.uid == $playerId",
                // CRITICAL: These fields are server-controlled only
                "isHost": {
                  ".write": false
                },
                "hasActed": {
                  // Server controls this to prevent client spoofing night actions
                  ".write": false
                },
                "vote": {
                  // Server controls voting to prevent manipulation
                  ".write": false
                }
              }
            },

            // Game state: readable by all, only server writes
            "state": {
              ".read": true,
              ".write": false
            },

            // Original role assignments: NEVER readable by clients
            "roles": {
              ".read": false,
              ".write": false
            },

            // Current roles after swaps: NEVER readable by clients
            "currentRoles": {
              ".read": false,
              ".write": false
            },

            // Center cards: NEVER readable by clients (revealed in result only)
            "centerCards": {
              ".read": false,
              ".write": false
            },

            // Night action log: NEVER readable by clients
            "nightActions": {
              ".read": false,
              ".write": false
            },

            // Game result: readable only after game ends
            "result": {
              ".read": true,
              ".write": false
            },

            // Private player data: each player can ONLY read their own
            "privatePlayerData": {
              ".read": false,
              "$playerId": {
                // CRITICAL: Only the owner can read their role/action info
                ".read": "auth != null && auth.uid == $playerId",
                // Only server can write role assignments
                ".write": false
              }
            }
          }
        }
      }
    },

    "$other": {
      ".read": false,
      ".write": false
    }
  }
}
